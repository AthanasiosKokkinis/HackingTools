#include<fstream>
#include<windows.h>

std::string GetClipboardData(void);

int main()
{
    std::ofstream out;
    std::string prev_data = "";
    std::string data;

    for(;;)
    {
        data = GetClipboardData();
        if (data.compare(prev_data) != 0)
        {
            out.open("test.txt", std::ios_base::app);
            out << GetClipboardData() << "\n";
            out.close();
            prev_data = data;
        }
        
        Sleep(1*1000);
    }
    return 0;
}

std::string GetClipboardData(void)
{
    if (!OpenClipboard(nullptr)) // nullptr = Let this task be the data handler
    {
        exit(-2);
    }

    HANDLE dataHandler = GetClipboardData(CF_TEXT); // Get the data handler 

    PVOID dataStart = GlobalLock(dataHandler);

    char * pszText = static_cast<char*>(dataStart); 

    if(pszText == nullptr)
    {
        exit(-2);
    }

    std::string text(pszText);
    GlobalUnlock(dataHandler);
    CloseClipboard();
    return text;
}