#include<fstream>
#include<windows.h>

std::string GetClipboardData(void);

int main()
{
    std::ofstream out;
    std::string prev_data = "";
    std::string data;

    for(;;)
    {
        data = GetClipboardData();
        if (data.compare(prev_data) != 0) // If data is the same as before then don't bother appending it to the file
        {
            out.open("test.txt", std::ios_base::app);
            out << GetClipboardData() << "\n";
            out.close();
            prev_data = data;
        }
        
        Sleep(1*1000); // Sleep for 1 second
    }
    return 0;
}

std::string GetClipboardData(void)
{
    if (!OpenClipboard(nullptr)) // nullptr = Let this task be the data handler
    {
        exit(-2);
    }

    HANDLE dataHandler = GetClipboardData(CF_TEXT); // Get the data handler 

    PVOID dataStart = GlobalLock(dataHandler); // Lock it so we can copy it without errors

    char * pszText = static_cast<char*>(dataStart); 

    if(pszText == nullptr) // If the data is not text : fail. Will add better control later.
    {
        exit(-2);
    }

    std::string text(pszText);
    GlobalUnlock(dataHandler); // Let the user continue normally
    CloseClipboard(); // Close the handler
    return text; 
}
